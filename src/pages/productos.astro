---
import { getCollection } from "astro:content";
import Layout from "../layouts/Layout.astro";
import ProductCard from "../components/ProductCard.astro";
import CategoryCard from "../components/CategoryCard.astro";
import { categorias } from "../lib/categorias";

// Obtener todos los productos
const productos = await getCollection("productos");
---

<Layout title="Productos – Sunart BCN">
  <section>
    <div class="flex justify-between items-center mb-6">
      <h1
        class="text-4xl font-serif text-brand-700"
        transition:name="main-heading"
      >
        Productos
      </h1>
    </div>

    <div class="mb-12">
      <h2 class="text-2xl font-serif text-brand-600 mb-6">
        Explorar por categorías
      </h2>
      <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
        {
          categorias
            .filter((cat) => cat.imagen)
            .map((cat) => (
              <CategoryCard
                id={cat.id}
                nombre={cat.nombre}
                imagen={cat.imagen}
              />
            ))
        }
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      {productos.map(({ slug, data }) => <ProductCard slug={slug} {...data} />)}
    </div>
  </section>

  <script>
    // Script para el menú desplegable de categorías en móvil
    document.addEventListener("DOMContentLoaded", () => {
      const button = document.getElementById("categoryMenuButton");
      const menu = document.getElementById("categoryMenu");

      if (button && menu) {
        button.addEventListener("click", () => {
          menu.classList.toggle("hidden");
        });

        // Cerrar el menú cuando se hace clic fuera de él
        document.addEventListener("click", (e) => {
          if (!button.contains(e.target) && !menu.contains(e.target)) {
            menu.classList.add("hidden");
          }
        });
      }
    });
  </script>
</Layout>
